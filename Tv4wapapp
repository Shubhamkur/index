<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>TV4WAP.SITE</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* --- 1. GLOBAL RESET & THEME --- */
        :root {
            /* BRIGHT CYAN-BLUE GRADIENT */
            --primary-gradient: linear-gradient(90deg, #00c6ff 0%, #0072ff 100%);
            --bg-color: #f4f6f9; /* Soft Blue-Grey */
            --card-bg: #ffffff;
            --text-color: #333;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            overflow-x: hidden;
            padding-top: 65px; 
            padding-bottom: 85px; 
        }

        /* --- 2. HEADER --- */
        header {
            position: fixed; top: 0; left: 0; width: 100%; height: 60px; 
            z-index: 1000;
            background: var(--primary-gradient); 
            display: flex; flex-direction: row; 
            align-items: center; justify-content: space-between;
            padding: 0 15px;
            box-shadow: 0 2px 10px rgba(0, 114, 255, 0.3);
        }

        /* LOGO */
        .logo-box a { 
            font-size: 20px; font-weight: 900; letter-spacing: 0.5px; 
            text-decoration: none; text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        .logo-text-white { color: #ffffff; }
        .logo-text-gold { color: #FFD700; } 

        /* HEADER ICONS */
        .header-icons { display: flex; gap: 10px; align-items: center; }

        .tg-circle {
            width: 32px; height: 32px;
            background: white;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            text-decoration: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.15);
            transition: transform 0.2s;
            cursor: pointer; border: none;
        }
        .tg-circle:hover { transform: scale(1.1); }
        .tg-circle i { font-size: 16px; }

        .icon-blue { color: #0088cc; }
        .icon-red { color: #ff3b30; }
        .icon-green { color: #28a745; }
        .icon-gold { color: #FFC107; }

        /* --- 3. BOTTOM NAV --- */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 75px;
            background: var(--primary-gradient);
            display: flex; justify-content: space-around; align-items: center;
            border-top: 1px solid rgba(255,255,255,0.2);
            z-index: 1000;
            padding-bottom: 5px;
            box-shadow: 0 -4px 15px rgba(0, 114, 255, 0.2);
        }
        
        .nav-btn {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer; flex: 1; height: 100%; position: relative; 
        }
        
        .nav-img {
            width: 32px; height: 32px;
            margin-bottom: 4px; object-fit: fall;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
        }
        
        .nav-svg {
            width: 32px; height: 32px; margin-bottom: 4px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
        }

        .nav-label {
            font-size: 11px; font-weight: 500;
            color: rgba(255, 255, 255, 0.8);
            transition: color 0.3s;
        }

        /* ACTIVE STATE */
        .nav-btn.active .nav-label { 
            color: #FFD700; font-weight: 800; text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }
        .nav-btn.active .nav-img, .nav-btn.active .nav-svg { transform: none; }

        /* --- 4. VIEW SECTIONS --- */
        .view-section { display: none; padding: 10px; min-height: 80vh; animation: fadeIn 0.4s ease-out; }
        .view-section.active-view { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- 5. HOME & TV LIST STYLES --- */
        .az-filter-container {
            display: flex; gap: 5px; overflow-x: auto;
            padding: 5px 0 15px 0; margin-bottom: 5px; scrollbar-width: none;
        }
        .az-filter-container::-webkit-scrollbar { display: none; }

        .az-btn {
            background: white; border: 1px solid #e0e0e0;
            padding: 5px 12px; border-radius: 20px;
            font-size: 11px; font-weight: 700; color: #555;
            cursor: pointer; white-space: nowrap; transition: 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .az-btn.active {
            background: #0072ff; color: white; border-color: #0072ff;
            box-shadow: 0 2px 8px rgba(0, 114, 255, 0.4);
        }

        .filter-container {
            background: white; padding: 10px; border-radius: 12px;
            margin-bottom: 10px; display: flex; gap: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .search-input, .group-select {
            padding: 10px; border: 1px solid #e0e0e0; border-radius: 8px;
            font-size: 13px; outline: none; width: 50%; background: #f9f9f9;
        }

        .grid-container {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;
            max-width: 800px; margin: 0 auto;
        }

        .exam-card {
            background-color: var(--card-bg);
            border-radius: 12px; padding: 10px 5px;
            text-align: center; display: flex; flex-direction: column; align-items: center; justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); text-decoration: none; color: #333;
            min-height: 110px; border: 1px solid #eee; transition: transform 0.2s;
            overflow: hidden; 
        }
        .exam-card:active { transform: scale(0.96); }
        
        .card-icon-bg {
            width: 100%; height: 60px; background: #f8f9fa; 
            border-radius: 6px; display: flex; align-items: center; justify-content: center;
            margin-bottom: 8px; overflow: hidden; border: 1px solid #eee;
        }
        .card-icon-bg img { width: 100%; height: 100%; object-fit: fall; }
        
        .exam-card b { 
            font-size: 11px; font-weight: 700; color: #444;
            display: block; width: 100%; 
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
            margin-top: 5px; padding: 0 4px;
        }

        /* --- 6. DISCLAIMER MODAL --- */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 2000;
            align-items: center; justify-content: center; animation: fadeIn 0.3s;
        }
        .modal-content {
            background: white; width: 90%; max-width: 400px; padding: 20px;
            border-radius: 15px; text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); border: 2px solid #0072ff;
        }
        .modal-content h3 { color: #0072ff; margin-bottom: 10px; }
        .modal-content p { font-size: 13px; color: #555; line-height: 1.5; margin-bottom: 15px; }
        .contact-box { background: #f0f4f8; padding: 10px; border-radius: 8px; font-weight: bold; color: #333; font-size: 12px; margin-bottom: 15px; }
        .close-btn {
            background: var(--primary-gradient); color: white; border: none;
            padding: 10px 20px; border-radius: 20px; font-weight: bold; cursor: pointer; width: 100%;
        }

        /* --- 7. PREMIUM MATCHES STYLES --- */
        #matches-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); /* Responsive Grid */
            gap: 15px;
            max-width: 1200px;
            margin: 0 auto;
            font-family: 'Poppins', sans-serif;
        }

        /* 10 Premium Themes */
        .theme-0 { --header-bg: linear-gradient(135deg, #0d47a1 0%, #1976d2 100%); --accent: #0d47a1; }
        .theme-1 { --header-bg: linear-gradient(135deg, #4a148c 0%, #7b1fa2 100%); --accent: #4a148c; }
        .theme-2 { --header-bg: linear-gradient(135deg, #1b5e20 0%, #388e3c 100%); --accent: #1b5e20; }
        .theme-3 { --header-bg: linear-gradient(135deg, #b71c1c 0%, #d32f2f 100%); --accent: #b71c1c; }
        .theme-4 { --header-bg: linear-gradient(135deg, #e65100 0%, #f57c00 100%); --accent: #e65100; }
        .theme-5 { --header-bg: linear-gradient(135deg, #006064 0%, #0097a7 100%); --accent: #006064; }
        .theme-6 { --header-bg: linear-gradient(135deg, #212121 0%, #424242 100%); --accent: #212121; }
        .theme-7 { --header-bg: linear-gradient(135deg, #f57f17 0%, #fbc02d 100%); --accent: #f57f17; }
        .theme-8 { --header-bg: linear-gradient(135deg, #880e4f 0%, #c2185b 100%); --accent: #880e4f; }
        .theme-9 { --header-bg: linear-gradient(135deg, #1a237e 0%, #303f9f 100%); --accent: #1a237e; }

        /* Match Card */
        .match-card {
            background: #ffffff; border-radius: 16px; overflow: hidden;
            box-shadow: 0 10px 25px rgba(0,0,0,0.06); border: 1px solid rgba(0,0,0,0.03);
            display: flex; flex-direction: column; position: relative;
            cursor: pointer; transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        .match-card:hover { transform: translateY(-3px); box-shadow: 0 15px 30px rgba(0,0,0,0.1); }

        .card-header-match {
            background: var(--header-bg); color: white; padding: 8px 10px;
            text-align: center; font-size: 10px; font-weight: 800;
            text-transform: uppercase; letter-spacing: 0.8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .card-body-match { 
            padding: 15px 12px; display: flex; justify-content: space-between; align-items: center;
        }
        
        .team-block { display: flex; flex-direction: column; align-items: center; width: 80px; text-align: center; }
        
        .team-logo {
            width: 50px; height: 50px; border-radius: 50%; padding: 3px; 
            object-fit: fall; margin-bottom: 6px; background: white;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1); border: 2px solid #f8f9fa;
        }
        
        .team-name {
            font-size: 9px; font-weight: 700; color: #333; text-transform: uppercase;
            line-height: 1.2; max-width: 100%; overflow: hidden;
            display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; opacity: 0.9;
        }

        .center-section {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            flex-grow: 1; margin-top: -2px;
        }

        /* Timer */
        .countdown-container { display: flex; gap: 6px; margin-bottom: 8px; }
        .cd-box { display: flex; flex-direction: column; align-items: center; }
        .cd-circle {
            width: 30px; height: 30px; 
            background: linear-gradient(180deg, #ff4081 0%, #c51162 100%); 
            color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-weight: 700; font-size: 9px; margin-bottom: 2px;
            box-shadow: 0 3px 6px rgba(197, 17, 98, 0.3); border-top: 1px solid rgba(255,255,255,0.4);
        }
        .cd-label { font-size: 7px; color: #999; font-weight: 700; letter-spacing: 0.5px; }

        .date-pill {
            background: var(--accent); color: white; padding: 4px 14px;
            border-radius: 20px; font-size: 9px; font-weight: 600;
            display: flex; align-items: center; gap: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.15); opacity: 0.9;
        }

        /* Links Drawer */
        .links-area {
            display: none; background: #fafafa; padding: 15px 10px; 
            border-top: 1px dashed #e0e0e0; overflow-x: auto; white-space: nowrap;
            text-align: left; animation: slideDown 0.3s ease-out;
        }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .links-area::-webkit-scrollbar { height: 0px; }
        
        .channel-item-match {
            display: inline-block; text-decoration: none; width: 65px; 
            margin-right: 12px; text-align: center; vertical-align: top; transition: transform 0.2s;
        }
        .channel-item-match:active { transform: scale(0.95); }

        .channel-logo-match {
            width: 42px; height: 42px; border-radius: 50%; border: 2px solid #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); object-fit: fall;
            display: block; margin: 0 auto 5px auto;
        }
        .channel-name-match {
            display: block; font-size: 9px; color: #555; font-weight: 600;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }

        .live-indicator {
            color: #d32f2f; font-weight: 900; font-size: 11px; 
            letter-spacing: 1px; animation: liveBlink 1.5s infinite ease-in-out;
            background: #ffebee; padding: 4px 10px; border-radius: 10px;
        }
        @keyframes liveBlink { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }

    </style>
</head>
<body>

    <header>
        <div class="logo-box">
            <a href="https://tv4wap.site">
                <span class="logo-text-white">TV4WAP</span><span class="logo-text-gold">.SITE</span>
            </a>
        </div>
        <div class="header-icons">
            <button class="tg-circle" onclick="toggleDisclaimer()" title="Disclaimer">
                <i class="fas fa-exclamation-triangle icon-gold"></i>
            </button>
            <a href="https://t.me/tvgotk" class="tg-circle"><i class="fab fa-telegram-plane icon-blue"></i></a>
            <a href="https://t.me/tv4wap" class="tg-circle"><i class="fas fa-paper-plane icon-red"></i></a>
            <a href="https://t.me/waptvgo" class="tg-circle"><i class="fab fa-telegram icon-green"></i></a>
        </div>
    </header>

    <div id="disclaimer-modal" class="modal-overlay" onclick="closeOnOverlay(event)">
        <div class="modal-content">
            <h3><i class="fas fa-exclamation-circle"></i> Disclaimer</h3>
            <p>This site is not affiliated with any television channel. All content is copyright of their respective owners. We cannot accept any responsibility for the content on this site. We do not host any content.</p>
            <div class="contact-box">Contact: Wapgotube@gmail.com</div>
            <button class="close-btn" onclick="toggleDisclaimer()">Close</button>
        </div>
    </div>

    <div id="home-view" class="view-section active-view">
        <div id="app-grid" class="grid-container">
            <p style="text-align:center; width:300%; font-size:12px; margin-top:20px;">Loading...</p>
        </div>
    </div>

    <div id="tvlist-view" class="view-section">
        <div class="az-filter-container" id="az-bar"></div>
        <div class="filter-container">
            <input type="text" id="tv-search" class="search-input" placeholder="Search All Channels..." onkeyup="filterTvList()">
            <select id="group-select" class="group-select" onchange="filterTvList()">
                <option value="all">All Groups</option>
            </select>
        </div>
        <div id="tvlist-container" class="grid-container">
            <p style="text-align:center; width:300%; color:#aaa; font-size:12px;">Loading Default List...</p>
        </div>
    </div>

    <div id="sportstv-view" class="view-section">
        <div id="sportstv-container" class="grid-container">
            <p style="text-align:center; width:300%; color:#aaa; margin-top:20px;">Loading...</p>
        </div>
    </div>

    <div id="matches-view" class="view-section">
        <div id="matches-container">
            <p id="matches-loading" style="text-align:center; font-size:14px; margin-top:30px; width:100%; color:#666;">
                <i class="fas fa-circle-notch fa-spin"></i> Loading Live Matches...
            </p>
        </div>
    </div>


    <nav class="bottom-nav">
        <div class="nav-btn active home-btn" onclick="switchTab('home')">
            <svg class="nav-svg" viewBox="0 0 512 512">
                <path fill="#FFC107" d="M256 0L0 236h38v276h178v-138h80v138h178V236h38z"/>
                <path fill="#FF3D00" d="M0 236L256 0l256 236h-38L256 36 38 236z"/>
                <path fill="#607D8B" d="M216 374h80v138h-80z"/>
            </svg>
            <span class="nav-label">Home</span>
        </div>
        
        <div class="nav-btn tvlist-btn" onclick="switchTab('tvlist')">
            <svg class="nav-svg" viewBox="0 0 512 512">
                <path fill="#2196F3" d="M112 48h288v416H112z"/>
                <path fill="#90CAF9" d="M144 96h224v16H144zm0 64h224v16H144zm0 64h224v16H144z"/>
                <path fill="#FFC107" d="M192 16h128v48H192z"/>
                <circle fill="#4CAF50" cx="256" cy="350" r="40"/>
                <path fill="#fff" d="M246 350l-10-10 20 20 40-40"/>
            </svg>
            <span class="nav-label">TV List</span>
        </div>

        <div class="nav-btn sports-btn" onclick="switchTab('sportstv')">
            <svg class="nav-svg" viewBox="0 0 512 512">
                <rect x="32" y="96" width="448" height="320" rx="40" fill="#FF5722"/>
                <rect x="64" y="128" width="320" height="256" rx="20" fill="#B3E5FC"/>
                <circle cx="416" cy="160" r="16" fill="#D84315"/>
                <circle cx="416" cy="224" r="16" fill="#D84315"/>
                <path stroke="#555" stroke-width="15" stroke-linecap="round" d="M150 96L90 32 M362 96L422 32"/>
            </svg>
            <span class="nav-label">Sports Tv</span>
        </div>

        <div class="nav-btn matches-btn" onclick="switchTab('matches')">
            <svg class="nav-svg" viewBox="0 0 512 512">
                <rect x="160" y="150" width="20" height="300" fill="#FFC107"/>
                <rect x="246" y="150" width="20" height="300" fill="#FFC107"/>
                <rect x="332" y="150" width="20" height="300" fill="#FFC107"/>
                <rect x="150" y="140" width="100" height="10" fill="#795548"/>
                <rect x="260" y="140" width="100" height="10" fill="#795548"/>
                <circle cx="400" cy="400" r="40" fill="#D50000"/>
                <path stroke="#fff" stroke-width="3" d="M370 380 q 30 -20 60 0"/>
            </svg>
            <span class="nav-label">Matches</span>
        </div>
    </nav>

    <script>
        // Disclaimer
        function toggleDisclaimer() {
            const modal = document.getElementById('disclaimer-modal');
            modal.style.display = (modal.style.display === 'flex') ? 'none' : 'flex';
        }
        function closeOnOverlay(e) {
            if(e.target.id === 'disclaimer-modal') toggleDisclaimer();
        }

        // TABS
        function switchTab(tabName, fromAppClick = false) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active-view'));
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(tabName + '-view').classList.add('active-view');

            if(tabName === 'home') document.querySelector('.home-btn').classList.add('active');
            if(tabName === 'tvlist') {
                document.querySelector('.tvlist-btn').classList.add('active');
                if(!fromAppClick && currentTvData.length === 0) loadAllChannelsMerged(); 
            }
            if(tabName === 'sportstv') document.querySelector('.sports-btn').classList.add('active');
            if(tabName === 'matches') document.querySelector('.matches-btn').classList.add('active');
        }

        const APPLIST_URL = "https://raw.githubusercontent.com/Shubhamkur/index/refs/heads/main/applist"; 

        async function loadHomeApps() {
            try {
                const res = await fetch(APPLIST_URL);
                const data = await res.json();
                renderHomeGrid(data, 'app-grid');
            } catch (err) { console.error(err); }
        }

        // --- M3U PARSER FUNCTION ---
        function parseM3uData(data) {
            const channels = [];
            const lines = data.split('\n');

            for (let i = 0; i < lines.length; i++) {
                if (lines[i].startsWith('#EXTINF')) {
                    const infoLine = lines[i];
                    const urlLine = lines[i + 1] ? lines[i + 1].trim() : '';
                    
                    if (!urlLine || urlLine.startsWith('#'))
                    // 3. Must START with 'http' (!urlLine.startsWith('http'))
                    if (!urlLine || urlLine.startsWith('#') || !urlLine.startsWith('http')) {
                        continue; 
                    }

                    const nameMatch = infoLine.match(/s*,(.+)/);
                    const logoMatch = infoLine.match(/tvg-logo="(.*?)"/);
                    const groupMatch = infoLine.match(/group-title="(.*?)"/);
                    const idMatch = infoLine.match(/tvg-id="(.*?)"/);

                    const name = nameMatch ? nameMatch[1].trim() : "Unknown";

                    channels.push({
                        name: name,
                        id: idMatch ? idMatch[1] : '', 
                        title: name,
                        logo: logoMatch ? logoMatch[1] : "",
                        group: groupMatch ? groupMatch[1] : "M3U Channels",
                        streamUrl: urlLine     
                    });
                }
            }
            return channels;
        }

        // --- TV LIST MERGED LOGIC (JSON + M3U) ---
        let currentTvData = []; 
        let currentFilterLetter = "All";

        async function loadAllChannelsMerged() {
            document.getElementById('tvlist-container').innerHTML = '<p style="text-align:center; width:300%; margin-top:20px;">Fetching All Channels...</p>';
            createAZBar(); 

            try {
                const appsRes = await fetch(APPLIST_URL);
                const appsData = await appsRes.json();
                let allChans = [];

                const promises = appsData.map(async (app) => {
                    if(!app.url || !app.id) return [];
                    try {
                        const cRes = await fetch(app.url);
                        const responseText = await cRes.text(); // Get raw text
                        
                        let items = [];
                        
                        // 1. Try JSON
                        try {
                            const cData = JSON.parse(responseText);
                            const rawItems = cData.data || cData;
                            
                            items = rawItems.map(ch => ({
                                name: ch.name || ch.title || "Unknown",
                                logo: ch.logo || "https://placehold.co/100?text=TV",
                                id: ch.id || ch.name,
                                group: ch.genre || "General",
                                player: app.jsonm3u,
                                homeId: app.id
                            }));
                        } catch (jsonErr) {
                            // 2. Try M3U
                            if (responseText.includes('#EXTM3U') || responseText.includes('#EXTINF')) {
                                const m3uItems = parseM3uData(responseText);
                                items = m3uItems.map(ch => ({
                                    name: ch.name,
                                    logo: ch.logo || "https://placehold.co/100?text=TV",
                                    id: ch.streamUrl, // Use Stream URL as ID for M3U
                                    group: ch.group,
                                    player: app.jsonm3u,
                                    homeId: app.id
                                }));
                            }
                        }
                        
                        return items;
                    } catch(e) { return []; }
                });

                const results = await Promise.all(promises);
                results.forEach(r => allChans = [...allChans, ...r]);
                
                allChans.sort((a, b) => a.name.localeCompare(b.name));
                currentTvData = allChans;
                filterTvList(); 

            } catch (e) {
                console.error(e);
                document.getElementById('tvlist-container').innerHTML = '<p>Failed to load data.</p>';
            }
        }

        // --- OPEN SINGLE APP (JSON + M3U) ---
        async function openSingleApp(url, playerHost, homeId, appName) {
            switchTab('tvlist', true);
            document.getElementById('tvlist-container').innerHTML = '<p>Loading...</p>';
            try {
                const res = await fetch(url);
                const responseText = await res.text();
                
                let items = [];

                // 1. Try JSON
                try {
                    const data = JSON.parse(responseText);
                    const rawItems = data.data || data;
                    items = rawItems.map(ch => ({
                        name: ch.name || ch.title || "Unknown",
                        logo: ch.logo || "https://placehold.co/100?text=TV",
                        id: ch.id || ch.name,
                        group: ch.genre || "General",
                        player: playerHost,
                        homeId: homeId
                    }));
                } catch (jsonErr) {
                    // 2. Try M3U
                    if (responseText.includes('#EXTM3U') || responseText.includes('#EXTINF')) {
                        const m3uItems = parseM3uData(responseText);
                        items = m3uItems.map(ch => ({
                            name: ch.name,
                            logo: ch.logo || "https://placehold.co/100?text=TV",
                            id: ch.id, // Use Stream URL as ID for M3U
                            group: ch.group,
                            player: playerHost,
                            homeId: homeId
                        }));
                    }
                }

                currentTvData = items;
                currentTvData.sort((a, b) => a.name.localeCompare(b.name));
                populateFilter(); 
                renderTvList(currentTvData);
            } catch(e) { console.log(e); }
        }

        function renderHomeGrid(data, containerId) {
            const html = data.map(item => {
                const appName = item.name || item.title || "Unknown";
                const appLogo = item.logo ? item.logo : "https://placehold.co/400x250/e0e0e0/333333?text=APP";
                if (item.id) {
                    return `<div class="exam-card" onclick="openSingleApp('${item.url}', '${item.jsonm3u}', '${item.id}', '${appName}')">
                            <div class="card-icon-bg"><img src="${appLogo}"></div><b>${appName}</b></div>`;
                } else {
                    return `<a href="${item.url}" target="_blank" class="exam-card">
                            <div class="card-icon-bg"><img src="${appLogo}"></div><b>${appName}</b></a>`;
                }
            }).join("");
            document.getElementById(containerId).innerHTML = html;
        }

        function populateFilter() {
            const groups = [...new Set(currentTvData.map(i => i.group))].sort();
            const select = document.getElementById('group-select');
            select.innerHTML = '<option value="all">All Groups</option>';
            groups.forEach(g => { const opt = document.createElement('option'); opt.value = g; opt.textContent = g; select.appendChild(opt); });
        }

        function renderTvList(data) {
            if(data.length === 0) { document.getElementById('tvlist-container').innerHTML = '<p>No channels found.</p>'; return; }
            const html = data.map(item => {
                const host = item.player || "https://tv4go.pages.dev";
                // If M3U, item.id is the stream URL. 
                // Result: playerHost/?id=http://stream.m3u8&name=homeId
                const playLink = `${host}/?id=${item.id}&name=${item.homeId}`;
                return `
                    <a href="${playLink}" class="exam-card">
                        <div class="card-icon-bg"><img src="${item.logo}"></div><b>${item.name}</b>
                    </a>`;
            }).join("");
            document.getElementById('tvlist-container').innerHTML = html;
        }

        function createAZBar() {
            const azContainer = document.getElementById('az-bar');
            const letters = ['All', ...'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('')];
            azContainer.innerHTML = letters.map(l => 
                `<button class="az-btn ${l === 'All' ? 'active' : ''}" onclick="filterByLetter('${l}', this)">${l}</button>`
            ).join('');
        }

        function filterByLetter(letter, btn) {
            document.querySelectorAll('.az-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            currentFilterLetter = letter;
            if(letter === 'All') { filterTvList(); } else {
                const filtered = currentTvData.filter(i => i.name.toUpperCase().startsWith(letter));
                renderTvList(filtered);
            }
        }

        function filterTvList() {
            const term = document.getElementById('tv-search').value.toLowerCase();
            const group = document.getElementById('group-select').value;
            const filtered = currentTvData.filter(i => i.name.toLowerCase().includes(term) && (group==='all' || i.group===group));
            renderTvList(filtered);
        }

        // --- SPORTS TV (Direct Links) ---
        const LIVETV_JSON = "https://raw.githubusercontent.com/Shubhamkur/Tv/refs/heads/main/tvid";
        async function loadLiveTv() {
            try {
                const res = await fetch(LIVETV_JSON); const data = await res.json();
                document.getElementById('sportstv-container').innerHTML = (data.data||data).map(item => `
                    <div class="exam-card" onclick="window.location.href='https://tv4go.pages.dev/?id=${item.id}'">
                        <div class="card-icon-bg"><img src="${item.logo||'https://placehold.co/100?text=TV'}"></div><b>${item.name}</b>
                    </div>`).join("");
            } catch (e) { console.log(e); }
        }

        // --- NEW PREMIUM MATCHES LOGIC ---
        const MATCH_JSON_URLS = ['https://raw.githubusercontent.com/Shubhamkur/updatez/refs/heads/main/update', 'https://raw.githubusercontent.com/Shubhamkur/updatez/refs/heads/main/update1', 'https://raw.githubusercontent.com/Shubhamkur/updatez/refs/heads/main/update2', 
'https://raw.githubusercontent.com/Shubhamkur/updatez/refs/heads/main/update3', 'https://raw.githubusercontent.com/Shubhamkur/updatez/refs/heads/main/update4', 'https://raw.githubusercontent.com/Shubhamkur/updatez/refs/heads/main/update5', 
'https://raw.githubusercontent.com/Shubhamkur/updatez/refs/heads/main/update6', 'https://raw.githubusercontent.com/Shubhamkur/updatez/refs/heads/main/update7', 'https://raw.githubusercontent.com/Shubhamkur/updatez/refs/heads/main/update8', 
'https://raw.githubusercontent.com/Shubhamkur/updatez/refs/heads/main/update9'];

        function toggleMatchLinks(id) {
            const el = document.getElementById(`mlinks-${id}`);
            const all = document.querySelectorAll('.links-area');
            const isVisible = el.style.display === 'block';
            all.forEach(x => x.style.display = 'none');
            if(!isVisible) el.style.display = 'block';
        }

        function getMatchDateObject(dateStr, timeStr) {
            let [time, modifier] = timeStr.split(' ');
            let [hours, minutes] = time.split(':');
            if (hours === '12') hours = '00';
            if (modifier.toLowerCase() === 'pm') hours = parseInt(hours, 10) + 12;
            return new Date(`${dateStr}T${hours}:${minutes}:00`);
        }

        function getCountdown(matchDateObj) {
            const now = new Date();
            const diff = matchDateObj - now;
            if (diff < 0) return { d:'00',h:'00',m:'00',s:'00', isLive: true };
            const d = Math.floor(diff / (1000 * 60 * 60 * 24));
            const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const s = Math.floor((diff % (1000 * 60)) / 1000);
            return { d:d.toString().padStart(2,'0'), h:h.toString().padStart(2,'0'), m:m.toString().padStart(2,'0'), s:s.toString().padStart(2,'0'), isLive: false };
        }

        function startTimer(matchDateObj, elementId) {
            const el = document.getElementById(elementId);
            if(!el) return;
            const update = () => {
                const t = getCountdown(matchDateObj);
                if (t.isLive) {
                    el.innerHTML = '<div class="live-indicator">● LIVE NOW</div>'; return;
                }
                const circles = el.getElementsByClassName('cd-circle');
                if(circles.length > 0) {
                    circles[0].innerText = t.d; circles[1].innerText = t.h;
                    circles[2].innerText = t.m; circles[3].innerText = t.s;
                }
            };
            update(); setInterval(update, 1000);
        }

        async function loadMatches() {
            const container = document.getElementById('matches-container');
            const promises = MATCH_JSON_URLS.map((url, idx) => fetch(url).then(r=>r.ok?r.json():null).then(d=>({data:d, theme:idx})).catch(e=>null));
            const results = await Promise.all(promises);
            const valid = results.filter(x => x && x.data && x.data.matches);

            if(valid.length === 0) { container.innerHTML = "<p style='text-align:center; padding:20px;'>No Active Tournaments.</p>"; return; }

            container.innerHTML = ''; // Clear loading
            const now = new Date();
            let matchesToShow = [];

            valid.forEach(({data, theme}) => {
                let tournamentMatches = [];
                data.matches.forEach(m => {
                    const start = getMatchDateObject(m.date, m.time);
                    const end = new Date(start.getTime() + (6*60*60*1000));
                    if(now < end) {
                        m.startObj = start;
                        m.tournament = data.tournament;
                        m.links = data.global_streaming_links;
                        m.theme = theme;
                        tournamentMatches.push(m);
                    }
                });
                tournamentMatches.sort((a,b)=>a.startObj - b.startObj);
                if(tournamentMatches.length > 0) matchesToShow.push(tournamentMatches[0]);
            });

            matchesToShow.sort((a,b)=>a.startObj - b.startObj);

            if(matchesToShow.length === 0) { container.innerHTML = "<p style='text-align:center; padding:20px;'>No live matches right now.</p>"; return; }

            matchesToShow.forEach((m, idx) => {
                const uid = `match-${idx}`;
                const dateStr = m.startObj.toLocaleDateString('en-GB', { day: 'numeric', month: 'short' });
                
                let linksHtml = '';
                if(m.links && m.links.length > 0) {
                    linksHtml = m.links.map((l, li) => {
                        let u = typeof l === 'object' ? l.url : l;
                        let n = typeof l === 'object' ? l.name : `Link ${li+1}`;
                        let i = typeof l === 'object' && l.logo ? l.logo : `https://placehold.co/50x50/eee/333?text=${li+1}`;
                        return `<a href="${u}" class="channel-item-match"><img src="${i}" class="channel-logo-match"><span class="channel-name-match">${n}</span></a>`;
                    }).join('');
                } else { linksHtml = "<p style='font-size:10px;text-align:center;width:100%;color:#888;'>No Links Yet</p>"; }

                const card = document.createElement('div');
                card.className = `match-card theme-${m.theme}`;
                card.setAttribute('onclick', `toggleMatchLinks('${uid}')`);
                card.innerHTML = `
                    <div class="card-header-match">${m.tournament} | Match ${m.match_no}</div>
                    <div class="card-body-match">
                        <div class="team-block">
                            <img src="${m.home_team_logo}" class="team-logo"><span class="team-name">${m.home_team}</span>
                        </div>
                        <div class="center-section">
                            <div class="countdown-container" id="timer-${uid}">
                                <div class="cd-box"><div class="cd-circle">00</div><div class="cd-label">DAY</div></div>
                                <div class="cd-box"><div class="cd-circle">00</div><div class="cd-label">HR</div></div>
                                <div class="cd-box"><div class="cd-circle">00</div><div class="cd-label">MIN</div></div>
                                <div class="cd-box"><div class="cd-circle">00</div><div class="cd-label">SEC</div></div>
                            </div>
                            <div class="date-pill"><i class="far fa-calendar-alt"></i> ${dateStr} • ${m.time}</div>
                        </div>
                        <div class="team-block">
                            <img src="${m.away_team_logo}" class="team-logo"><span class="team-name">${m.away_team}</span>
                        </div>
                    </div>
                    <div id="mlinks-${uid}" class="links-area">${linksHtml}</div>
                `;
                container.appendChild(card);
                startTimer(m.startObj, `timer-${uid}`);
            });
        }

        window.onload = () => {
            const query = decodeURIComponent(window.location.search.substring(1)).replace(/\+/g, ' ');
            if (query) {
                document.getElementById('tv-search').value = query;
                switchTab('tvlist'); 
            } else {
                loadHomeApps();
            }
            loadMatches();
            loadLiveTv();
            document.addEventListener('contextmenu', e=>e.preventDefault());
        };
    </script>
</body>
</html>
